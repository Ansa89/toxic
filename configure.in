# Public domain
#
# This is a BSDBuild configure script source. The ./configure script is
# generated from this file via mkconfigure(1). For more information, see:
# http://bsdbuild.hypertriton.com/.
#

PACKAGE("Toxic")
VERSION("0.3.1")

REGISTER_SECTION("Toxic features")
REGISTER("--disable-av",		"Disables calling [no]")
REGISTER("--enable-debug",                "Builds Toxic with debugging flags [no]")
REGISTER_SECTION("paths")
REGISTER("--with-dependency-search=DIR",	"search for dependencies in DIR")
REGISTER("--with-libtoxcore=DIR",	"search for libtoxcore files in DIR")
REGISTER("--with-libsodium=DIR",	"search for libsodium files in DIR")
REGISTER("--with-libtoxav=DIR",	"search for libtoxav files in DIR")
REGISTER("--with-libopenal=DIR", "search for openal files in DIR")

REQUIRE(cc)
REQUIRE(ncurses)
REQUIRE(sodium,0.4.2,${prefix_libsodium})
REQUIRE(toxcore,0.0.0,${prefix_toxcore})

if [ "${enable_debug}" = "yes" ]; then
	MDEFINE(OPT_CFLAGS, "-O0 -g")
else
	MDEFINE(OPT_CFLAGS, "-O2")
fi

if [ "${enable_av}" != "no" ]; then
	CHECK(openal,0.0.0,${prefix_libopenal})
	CHECK(toxav,0.0.0,${prefix_libtoxav})
	HDEFINE(_SUPPORT_AUDIO,"yes")
	MDEFINE(CFLAGS, "-D_SUPPORT_AUDIO")
	if [ "${HAVE_TOXAV}" != "yes" ]; then
		echo "*"
		echo "* Tried to enable AV"
		echo "* But library toxav was not found"
		echo "*"
		exit 1
	fi
	if [ "${HAVE_OPENAL}" != "yes" ]; then
		echo "*"
		echo "* Tried to enable AV "
		echo "* But library openal was not found"
		echo "*"
		exit 1
	fi
else
        HDEFINE(_SUPPORT_AUDIO,"no")
fi

REV=`git rev-list HEAD --count`
TOXIC_VERSION="${VERSION}_r${REV}"
MDEFINE(TOXIC_VER,${TOXIC_VERSION})

CONFIG_SCRIPT(toxic, "-I${INCLDIR} ${CFLAGS}","-L${LIBDIR}")
